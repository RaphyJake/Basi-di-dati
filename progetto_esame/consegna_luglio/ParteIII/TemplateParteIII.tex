\documentclass[a4paper]{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{todonotes}
\usepackage{geometry}
\usepackage{listings}
\geometry{a4paper, top=3cm, bottom=3cm, left=3.5cm, right=3.5cm} % heightrounded, bindingoffset=5mm}

\title{Progetto Basi di Dati 2024-25 \\
“FANTASANREMO” \\
Parte III}
\author{Team 35
	\\
	\and Alessio Molinas 5339413\\Ettore Romano 5644926}
\date{}

\begin{document}

\maketitle


\section{Progettazione Fisica\\}

\subsection{CARICO DI LAVORO\\}

\subsubsection{Q1 - QUERY CON SINGOLA SELEZIONE E NESSUN JOIN\\}

\paragraph*{LINGUAGGIO NATURALE \\} 


\todo[inline]{Voglio ottenere, per tutti gli artisti di tipo \texttt{C}, il nome e cognome se si tratta di una persona, oppure il nome del gruppo se si tratta di un gruppo, insieme alla relativa biografia.}

\paragraph*{SQL \\}

%\todo[inline]
\begin{lstlisting}[language=SQL]
	SELECT 
	COALESCE(nomeGruppo, CONCAT(nome, ' ', cognome)) AS nome_artista,
	biografia
	FROM 
	artisti
	WHERE 
	tipo = 'C';
\end{lstlisting}



\subsubsection{Q2 - QUERY CON CONDIZIONE DI SELEZIONE COMPLESSA E NESSUN JOIN\\}

\paragraph*{LINGUAGGIO NATURALE\\}

\todo[inline]{Voglio ottenere, per tutti gli artisti di tipo \texttt{C} nati dopo dal 01-01-1992, tutti gli attributi}

\paragraph*{SQL \\}

\begin{lstlisting}[language=SQL]
SELECT *
FROM artisti
WHERE tipo = 'C'
AND dataNascita >= DATE '1992-01-01';
\end{lstlisting}


\subsubsection{Q3 - QUERY CON ALMENO UN JOIN E ALMENO UNA CONDIZIONE DI SELEZIONE\\ }

\paragraph*{LINGUAGGIO NATURALE\\}

\todo[inline]{Voglio ottenere, per ciascuna lega di tipo pubblico, l'elenco delle squadre partecipanti, includendo il nome della lega e il nome della squadra. È necessario unire le tabelle leghe, partecipazione\_leghe e squadre, e filtrare le leghe di tipo pubblico.}

\paragraph*{SQL \\}

%\todo[inline]{Riportare in questa sezione l’interrogazione del carico di lavoro con almeno un join e almeno una condizione di selezione, in SQL}
\begin{lstlisting}[language=SQL]
	SELECT 
	l.nome AS nome_lega,
	s.nome AS nome_squadra
	FROM 
	leghe l
	JOIN 
	partecipazione_leghe pl ON l.codLega = pl.codLega
	JOIN 
	squadre s ON pl.codSquadra = s.codSquadra
	WHERE 
	l.tipo = 'PUBBLICA';
\end{lstlisting}


\subsection{1D-PROGETTO FISICO\\}

\todo[inline]{Riportare nella seguente tabella l’elenco degli indici che si intendono creare per: (1) ciascuna query del carico di lavoro individualmente; (2) l’insieme delle query del carico di lavoro, motivando opportunamente, in modo sintetico, le scelte effettuate}


\begin{center}
\begin{footnotesize}
\begin{tabular}{|c|c|p{2cm}|p{2cm}|p{5cm}|}
\hline
{\bf Id query} & {\bf Relazione} & \parbox{2cm}{\bf Chiave di ricerca} & \parbox{2cm}{\bf Tipo (ordinato/hash, clusterizzato/non clusterizzato)} & \parbox{5cm}{\bf Motivazione} \\
\hline
Q1 & artisti & tipo & ordinato e clusterizzato &  Visto il numero frequente di query sull'attributo tipo (non UNIQUE) potrei optare per la clusterizzazione\\
Q2 & artisti & tipo, dataNascita & ordinato e clusterizzato & Devo escludere indice hash perchè è prevista ricerca per range sulla data nascita. Opterei per un indice composto per facilitare sia la query precedente che quella corrente\\
Q3 & leghe, partecipazione\_leghe, squadre & leghe.tipo & ordinato e clusterizzato & Oltre all'indice su leghe.tipo, introdurrei degli indici ordinati sulle chiavi utilizzate per eseguire le join. Questi permettono di utilizzare algoritmi di join come l'indexed nested loop.\\
\hline
\end{tabular}
\end{footnotesize}
\end{center}



\begin{center}
\begin{footnotesize}
\begin{tabular}{|p{6.5cm}|p{6.5cm}|}
\hline
\parbox{5cm}{\bf Schema fisico complessivo per il carico di lavoro} &  \parbox{5cm}{\bf Motivazione} \\
\hline
- indice ordinato e clusterizzato su (tipo, dataNascita), tabella artisti& Ricerca per tipo con uguaglianza e dataNascita per range (anche per ricerca attraverso solo tipo) \\
- indice ordinato e clusterizzato su tipo, tabella leghe& Ricerca per tipo, clusterizzato perchè tipo non è UNIQUE\\
- indice ordinato non clusterizzato su codLega, tabella partecipazione\_leghe & accesso alla relazione con indice per join con leghe\\
- indice ordinato non clusterizzato su codSquadra, tabella squadre & accesso alla relazione con indice per join con partecipazione\_leghe\\
\hline
\end{tabular}
\end{footnotesize}
\end{center}

\subsection{1G-ANALISI PIANI DI ESECUZIONE SCELTI DAL SISTEMA\\}


\subsubsection{Q1 - QUERY CON SINGOLA SELEZIONE E NESSUN JOIN\\}

\paragraph*{PIANO DI ESECUZIONE SCELTO DAL SISTEMA PRIMA DELLA CREAZIONE DELLO SCHEMA FISICO\\}

\todo[inline]{ Seq Scan on artisti as artisti
	Filter: (tipo = 'CANTANTE'::tipo\_artista)}


\paragraph*{PIANO DI ESECUZIONE SCELTO DAL SISTEMA DOPO DELLA CREAZIONE DELLO SCHEMA FISICO\\}

\todo[inline]{Riportare in questa sezione il piano di esecuzione scelto da PostgreSQL dopo della creazione dello schema fisi-cocomplessivo, in formato testuale}

\paragraph*{CONFRONTO TRA I DUE PIANI\\}

\todo[inline]{Riportare nella seguente tabella i tempi di esecuzione per i piani ottenuti prima e dopo la creazione dello schema fisico complessivo, giustificando i piani e i tempi ottenuti}


\begin{center}
\begin{footnotesize}
\begin{tabular}{|p{3cm}|p{3cm}|p{7cm}|}
\hline
\parbox{3cm}{\bf Tempo esecuzione PRIMA} & \parbox{3cm}{\bf Tempo esecuzione DOPO} &  \parbox{7cm}{\bf Motivazione} \\
\hline
& &  \\
\hline
\end{tabular}
\end{footnotesize}
\end{center}

\subsubsection{Q2 - QUERY CON CONDIZIONE DI SELEZIONE COMPLESSA E NESSUN JOIN\\}

\paragraph*{PIANO DI ESECUZIONE SCELTO DAL SISTEMA PRIMA DELLA CREAZIONE DELLO SCHEMA FISICO\\}

\todo[inline]{Seq Scan on artisti as artisti
Filter: ((datanascita $\geq$ '1992-01-01'::date) AND (tipo = 'CANTANTE'::tipo\_artista))}

\paragraph*{PIANO DI ESECUZIONE SCELTO DAL SISTEMA DOPO DELLA CREAZIONE DELLO SCHEMA FISICO\\}

\todo[inline]{Riportare in questa sezione il piano di esecuzione scelto da PostgreSQL dopo della creazione dello schema fisi-co complessivo, in formato testuale}

\paragraph*{CONFRONTO TRA I DUE PIANI\\}

\todo[inline]{Riportare nella seguente tabella i tempi di esecuzione per i piani ottenuti prima e dopo la creazione dello schema fisico complessivo, giustificando i piani e i tempi ottenuti}


\begin{center}
\begin{footnotesize}
\begin{tabular}{|p{3cm}|p{3cm}|p{7cm}|}
\hline
\parbox{3cm}{\bf Tempo esecuzione PRIMA} & \parbox{3cm}{\bf Tempo esecuzione DOPO} &  \parbox{7cm}{\bf Motivazione} \\
\hline
& &  \\
\hline
\end{tabular}
\end{footnotesize}
\end{center}



\subsubsection{Q3 - QUERY CON ALMENO UN JOIN E ALMENO UNA CONDIZIONE DI SELEZIONE \\}

\paragraph*{PIANO DI ESECUZIONE SCELTO DAL SISTEMA PRIMA DELLA CREAZIONE DELLO SCHEMA FISICO\\}

\todo[inline]{Riportare in questa sezione il piano di esecuzione scelto da PostgreSQL prima della creazione dello schema fi-sico complessivo, in formato testuale}

\paragraph*{PIANO DI ESECUZIONE SCELTO DAL SISTEMA DOPO DELLA CREAZIONE DELLO SCHEMA FISICO\\}

\todo[inline]{Riportare in questa sezione il piano di esecuzione scelto da PostgreSQL dopo della creazione dello schema fisi-co complessivo, in formato testuale}

\paragraph*{CONFRONTO TRA I DUE PIANI\\}

\todo[inline]{Riportare nella seguente tabella i tempi di esecuzione per i piani ottenuti prima e dopo la creazione dello schema fisico complessivo, giustificando i piani e i tempi ottenuti}


\begin{center}
\begin{footnotesize}
\begin{tabular}{|p{3cm}|p{3cm}|p{7cm}|}
\hline
\parbox{3cm}{\bf Tempo esecuzione PRIMA} & \parbox{3cm}{\bf Tempo esecuzione DOPO} &  \parbox{7cm}{\bf Motivazione} \\
\hline
& &  \\
\hline
\end{tabular}
\end{footnotesize}
\end{center}




\section{CONTROLLO DELL’ACCESSO\\}

\subsection{GERARCHIA TRA I RUOLI \\}

\subsubsection{GERARCHIA\\}

\todo[inline]{Riportare in questa sezione la gerarchia che si intende definire tra i quattro ruoli}

\subsubsection{MOTIVAZIONE GERARCHIA}

\todo[inline]{Riportare in questa sezione una motivazione per la gerarchia proposta}


\subsection{ASSEGNAZIONE PRIVILEGI SPECIFICI AI RUOLI}

\todo[inline]{Riportare nella prima colonna della seguente tabella le relazioni considerate e in ciascuna altra cella (i,j) i privilegi specifici (quindi non acquisiti tramite la gerarchia) che si intendono assegnare al ruolo j sulla tabella }



\begin{center}
\begin{footnotesize}
\begin{tabular}{|c|p{2.7cm}|p{2.7cm}|p{2.7cm}|p{2.7cm}|}
\hline
{\bf Relazione} & \parbox{2.7cm}{\bf Amministratore del FantaSarremo} & \parbox{2.7cm}{\bf Utente} &  \parbox{2.7cm}{\bf Amministratore lega} & \parbox{2.7cm}{\bf Proprietario lega} \\
\hline
& &  & & \\
\hline
\end{tabular}
\end{footnotesize}
\end{center}


\end{document}
